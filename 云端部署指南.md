# ProdSync 云端部署指南 ☁️

## 🎯 快速部署

我已经为您准备了完整的云端部署配置！选择以下任一平台即可快速部署：

### 🚀 推荐平台

#### 1. Railway (最简单) ⭐
```bash
# 1. 安装Railway CLI
npm install -g @railway/cli

# 2. 登录Railway
railway login

# 3. 部署项目
railway up
```

#### 2. Render (免费额度) 💰
```bash
# 1. 推送代码到GitHub
git add .
git commit -m "Ready for cloud deployment"
git push origin main

# 2. 访问 https://render.com
# 3. 连接GitHub仓库
# 4. 选择"Web Service"
# 5. 使用以下配置：
#    - Build Command: npm run build
#    - Start Command: npm start
```

#### 3. Heroku (企业级) 🏢
```bash
# 1. 安装Heroku CLI
# 2. 登录Heroku
heroku login

# 3. 创建应用
heroku create your-app-name

# 4. 部署
git push heroku main
```

## 📋 部署前检查

### ✅ 项目已准备就绪
- [x] 云端优化的服务器配置
- [x] 生产环境的package.json
- [x] Docker支持
- [x] 静态文件服务
- [x] 数据库自动初始化
- [x] CORS配置
- [x] 健康检查接口

### 🔧 环境变量配置

在云平台设置以下环境变量：

```env
NODE_ENV=production
PORT=5001
JWT_SECRET=your-super-secret-jwt-key-2024
CLIENT_URL=https://your-domain.com
```

## 🌟 详细部署步骤

### Railway 部署 🚂

1. **准备代码**
   ```bash
   git add .
   git commit -m "Cloud deployment ready"
   ```

2. **Railway部署**
   ```bash
   # 安装CLI
   npm install -g @railway/cli
   
   # 登录
   railway login
   
   # 初始化项目
   railway up
   
   # 设置环境变量
   railway variables set NODE_ENV=production
   railway variables set JWT_SECRET=your-secret-key
   ```

3. **自动部署完成** ✨

### Render 部署 🎨

1. **推送到GitHub**
   ```bash
   git remote add origin https://github.com/your-username/prodsync.git
   git push -u origin main
   ```

2. **Render配置**
   - 访问 [render.com](https://render.com)
   - 连接GitHub仓库
   - 创建"Web Service"
   - 配置设置：
     ```
     Name: prodsync
     Environment: Node
     Build Command: npm run build
     Start Command: npm start
     ```

3. **环境变量设置**
   ```
   NODE_ENV=production
   JWT_SECRET=your-secret-key
   ```

### Heroku 部署 🚀

1. **Heroku设置**
   ```bash
   # 创建应用
   heroku create your-app-name
   
   # 设置环境变量
   heroku config:set NODE_ENV=production
   heroku config:set JWT_SECRET=your-secret-key
   
   # 部署
   git push heroku main
   ```

### Docker 部署 🐳

1. **构建镜像**
   ```bash
   docker build -t prodsync .
   ```

2. **运行容器**
   ```bash
   docker run -p 5001:5001 \
     -e NODE_ENV=production \
     -e JWT_SECRET=your-secret-key \
     prodsync
   ```

## 🔍 部署验证

### 健康检查
访问 `https://your-domain.com/health` 应该返回：
```json
{
  "status": "OK",
  "timestamp": "2024-01-20T10:30:00.000Z",
  "environment": "production",
  "version": "V3-Cloud"
}
```

### 功能测试
1. **登录测试**
   - 默认账号：admin / admin123
   
2. **API测试**
   - 任务管理功能
   - 用户管理功能
   - "收到任务"功能

## 📊 性能优化

### 已集成优化
- ✅ 静态文件压缩
- ✅ 数据库查询优化
- ✅ CORS配置优化
- ✅ 优雅关闭处理
- ✅ 健康检查

### 推荐配置
```json
{
  "memory": "512MB",
  "cpu": "0.5 vCPU",
  "timeout": "30s"
}
```

## 🔒 安全配置

### 生产环境安全
```env
# 强密码JWT密钥
JWT_SECRET=super-secure-random-key-with-64-characters-minimum

# HTTPS强制
FORCE_HTTPS=true

# 速率限制
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW=900000
```

## 🎯 域名配置

### 自定义域名
1. **DNS设置**
   ```
   CNAME: your-domain.com -> your-app.railway.app
   ```

2. **SSL证书**
   - Railway/Render/Heroku自动提供

## 📱 移动端适配

系统已完全适配移动设备：
- 响应式设计
- 触屏优化
- 移动端浏览器兼容

## 🎉 部署成功！

### 访问地址
- **生产环境**: https://your-domain.com
- **API接口**: https://your-domain.com/api
- **健康检查**: https://your-domain.com/health

### 默认账号
```
管理员：admin / admin123
调度员：scheduler01 / test123  
生产所领导：leader01 / test123
```

## 🆘 故障排除

### 常见问题

1. **部署失败**
   ```bash
   # 检查日志
   railway logs
   # 或
   heroku logs --tail
   ```

2. **数据库问题**
   - 云端会自动创建SQLite数据库
   - 数据持久化已配置

3. **CORS错误**
   - 已配置允许所有来源（生产环境可限制）

### 支持联系
如果遇到问题，请检查：
1. 环境变量是否正确设置
2. 构建日志是否有错误
3. 健康检查接口是否正常

---

**恭喜！您的ProdSync系统现在已经在云端运行了！** 🎉

系统地址：`https://your-domain.com`  
管理后台：`https://your-domain.com` (使用admin账号登录)